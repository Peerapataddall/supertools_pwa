{% extends "base.html" %}
{% block title %}{{ 'แก้ไขโปร' if p else 'เพิ่มโปร' }}{% endblock %}

{% block head %}
<style>
  .st-card{border:0;border-radius:18px;background:linear-gradient(180deg,#fff,#f8fbff);
    box-shadow:0 12px 30px rgba(16,24,40,.08);}
  .st-card-hd{padding:14px 18px;border-bottom:1px solid rgba(0,0,0,.06);
    background:linear-gradient(90deg,#eef4ff,#ffffff);border-top-left-radius:18px;border-top-right-radius:18px;}
</style>
{% endblock %}

{% block content %}
<div class="d-flex align-items-center justify-content-between mb-3">
  <div class="h5 m-0"><i class="bi bi-stars me-2"></i>{{ 'แก้ไขโปรโมชั่น' if p else 'สร้างโปรโมชั่น' }}</div>
  <a class="btn btn-outline-secondary btn-sm" href="{{ url_for('promos_list') }}"><i class="bi bi-arrow-left"></i> กลับ</a>
</div>

<div class="st-card">
  <div class="st-card-hd"><b>รายละเอียดโปรโมชั่น</b></div>
  <div class="p-3">
    <form method="post">
      <div class="row g-3">
        <div class="col-md-6">
          <label class="form-label">ชื่อโปร</label>
          <input name="name" class="form-control" required value="{{ p.name if p else '' }}">
        </div>
        <div class="col-md-3">
          <label class="form-label">สถานะ</label>
          <div class="form-check form-switch mt-2">
            <input class="form-check-input" type="checkbox" name="active" value="1" {{ 'checked' if (p and p.active) or not p }}>
            <label class="form-check-label">เปิดใช้งาน</label>
          </div>
        </div>
        <div class="col-md-3"></div>

        <div class="col-md-3">
          <label class="form-label">เริ่มใช้</label>
          <input type="date" name="start_date" class="form-control" value="{{ p.start_date if p else '' }}">
        </div>
        <div class="col-md-3">
          <label class="form-label">สิ้นสุด</label>
          <input type="date" name="end_date" class="form-control" value="{{ p.end_date if p else '' }}">
        </div>

        <div class="col-md-3">
          <label class="form-label">ขั้นต่ำจำนวนชิ้น</label>
          <input type="number" name="min_items" class="form-control" min="0" value="{{ p.min_items if p else 0 }}">
        </div>

        <div class="col-md-3">
          <label class="form-label">ชนิดระยะเวลา</label>
          <select name="rental_unit" class="form-select">
            <option value="DAY"   {{ 'selected' if (p and p.rental_unit=='DAY') }}>รายวัน</option>
            <option value="MONTH" {{ 'selected' if (p and p.rental_unit=='MONTH') }}>รายเดือน</option>
            <option value="YEAR"  {{ 'selected' if (p and p.rental_unit=='YEAR') }}>รายปี</option>
          </select>
        </div>
        <div class="col-md-3">
          <label class="form-label">ขั้นต่ำ (ตามชนิด)</label>
          <input type="number" name="min_duration" class="form-control" min="0" value="{{ p.min_duration if p else 0 }}">
        </div>

        <div class="col-md-3">
          <label class="form-label">ประเภทส่วนลด</label>
          <select name="discount_type" class="form-select">
            <option value="PCT" {{ 'selected' if (p and p.discount_type=='PCT') or not p }}>เปอร์เซ็น (%)</option>
            <option value="AMT" {{ 'selected' if (p and p.discount_type=='AMT') }}>จำนวนเงิน (บาท)</option>
          </select>
        </div>
        <div class="col-md-3">
          <label class="form-label">มูลค่าส่วนลด</label>
          <input type="number" step="0.01" name="discount_value" class="form-control"
                 value="{{ p.discount_value if p else 0 }}">
        </div>

        <div class="col-md-3">
          <label class="form-label">ลดจากชิ้นถูกสุด (หน่วยชิ้น)</label>
          <input type="number" name="cheapest_units_to_discount" min="1" class="form-control"
                 value="{{ p.cheapest_units_to_discount if p else 1 }}">
        </div>

        <div class="col-12">
          <label class="form-label">หมายเหตุ</label>
          <textarea name="note" class="form-control" rows="3">{{ p.note if p else '' }}</textarea>
        </div>
      </div>

      <div class="d-flex justify-content-end gap-2 mt-3">
        <a class="btn btn-outline-secondary" href="{{ url_for('promos_list') }}">ยกเลิก</a>
        <button class="btn btn-primary">บันทึก</button>
      </div>
    </form>
  </div>
</div>
{% endblock %}
