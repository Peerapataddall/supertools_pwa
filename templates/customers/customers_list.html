{% extends "base.html" %}
{% block title %}ลูกค้า (Customers){% endblock %}

{% block head %}
<style>
  /* ===== โทนสี & เอฟเฟกต์เงานุ่ม ===== */
  .fx-soft {
    background: linear-gradient(180deg, #f2f7ff 0%, #ffffff 60%);
    border: 1px solid #e8eefc;
    box-shadow:
      0 10px 30px rgba(73, 126, 255, .06),
      0 2px 6px rgba(45, 76, 150, .06);
  }
  .fx-soft-2 {
    background: linear-gradient(180deg, #f7fbff 0%, #ffffff 80%);
    border: 1px solid #eaf0ff;
    box-shadow:
      0 8px 22px rgba(0,0,0,.05),
      0 1px 2px rgba(0,0,0,.06);
  }

  /* ===== ไอคอนหัวการ์ด (ขนาดพอดีตา) ===== */
  .icon-pill {
    width: 46px; height: 46px;
    display: inline-grid; place-items: center;
    border-radius: 14px;
    color: #2f6feb;
    background: radial-gradient(120% 120% at 30% 20%, #d9e6ff 0%, #edf3ff 70%, #ffffff 100%);
    border: 1px solid #d7e4ff;
    box-shadow:
      inset 0 1px 0 rgba(255,255,255,.8),
      0 4px 12px rgba(47,111,235,.15);
  }
  .icon-pill i { font-size: 1.25rem; line-height: 1; }

  /* ===== ปุ่มไอคอนแบบกะทัดรัด ===== */
  .btn-icon {
    --size: 38px;
    width: var(--size); height: var(--size);
    display: inline-grid; place-items: center;
    padding: 0; border-radius: 12px;
  }
  .btn-icon i { font-size: 1rem; }
  .btn-outline-lightBlue{ color:#2f6feb; border-color:#bcd2ff; background:#fff; }
  .btn-outline-lightBlue:hover{ background:#eaf2ff; border-color:#9fc1ff; color:#1e63e9; }

  /* ===== กล่องตาราง ===== */
  .table-card{
    border-radius: 16px; overflow: hidden;
    border: 1px solid #eaeef7;
    box-shadow: 0 8px 22px rgba(0,0,0,.04);
    background: #fff;
  }
  .table thead th{
    background: linear-gradient(180deg,#f7fbff,#eff4ff);
    border-bottom: 1px solid #dee6f7;
  }
  .table tbody tr:hover { background: #f8fbff; }
  .addr{ max-width: 520px; }
  @media (max-width: 1200px){ .addr{ max-width: 360px; } }
</style>
{% endblock %}

{% block content %}
<!-- Header -->
<div class="fx-soft rounded-4 p-3 mb-3">
  <div class="d-flex justify-content-between align-items-center gap-3 flex-wrap">
    <div class="d-flex align-items-center gap-3">
      <span class="icon-pill"><i class="bi bi-people"></i></span>
      <div>
        <div class="h5 m-0 fw-semibold">ลูกค้า (Customers)</div>
        <div class="small text-muted">สำหรับใช้ออกใบเสนอราคา/เอกสารขาย</div>
      </div>
    </div>

    <div class="d-flex align-items-center gap-2">
      <form class="d-none d-md-block" method="get" action="{{ url_for('customers_list') }}">
        <div class="input-group">
          <input type="text" class="form-control" name="q" value="{{ request.args.get('q','') }}"
                 placeholder="ค้นหา: ชื่อ/เบอร์/ผู้ติดต่อ/ภาษี">
          <button class="btn btn-outline-lightBlue"><i class="bi bi-search"></i></button>
        </div>
      </form>

      <a href="{{ url_for('customers_new') }}" class="btn btn-primary rounded-3">
        <i class="bi bi-plus-lg me-1"></i> เพิ่มลูกค้า
      </a>
    </div>
  </div>

  <!-- search (mobile) -->
  <form class="mt-2 d-md-none" method="get" action="{{ url_for('customers_list') }}">
    <div class="input-group">
      <input type="text" class="form-control" name="q" value="{{ request.args.get('q','') }}"
             placeholder="ค้นหา: ชื่อ/เบอร์/ผู้ติดต่อ/ภาษี">
      <button class="btn btn-outline-lightBlue"><i class="bi bi-search"></i></button>
    </div>
  </form>
</div>

<!-- Table -->
<div class="table-card">
  <div class="table-responsive">
    <table class="table align-middle mb-0">
      <thead>
        <tr>
          <th style="width:28%">ชื่อลูกค้า</th>
          <th style="width:22%">ผู้ติดต่อ</th>
          <th style="width:14%">เบอร์โทร</th>
          <th style="width:16%">เลขผู้เสียภาษี</th>
          <th class="addr">ที่อยู่</th>
          <th class="text-center" style="width:110px">การทำงาน</th>
        </tr>
      </thead>
      <tbody>
        {% for c in customers %}
        <tr>
          <td class="fw-semibold">{{ c.name }}</td>
          <td>
            {{ c.contact_name or '-' }}
            {% if c.contact_phone %}<div class="small text-muted">{{ c.contact_phone }}</div>{% endif %}
          </td>
          <td>{{ c.phone or '-' }}</td>
          <td>{{ c.tax_id or '-' }}</td>
          <td class="addr">
            <div class="text-truncate">
              {{ c.address or '' }}
              {% if c.district %} ต.{{ c.district }}{% endif %}
              {% if c.amphoe %} อ.{{ c.amphoe }}{% endif %}
              {% if c.province %} จ.{{ c.province }}{% endif %}
              {% if c.postcode %} {{ c.postcode }}{% endif %}
            </div>
          </td>
          <td class="text-center">
            <a href="{{ url_for('customers_edit', cid=c.id) }}"
               class="btn btn-icon btn-outline-lightBlue me-1" data-bs-toggle="tooltip" title="แก้ไข">
              <i class="bi bi-pencil"></i>
            </a>
            <form action="{{ url_for('customers_delete', cid=c.id) }}" method="post" class="d-inline"
                  onsubmit="return confirm('ลบลูกค้ารายนี้?');">
              <button class="btn btn-icon btn-outline-danger" data-bs-toggle="tooltip" title="ลบ">
                <i class="bi bi-trash3"></i>
              </button>
            </form>
          </td>
        </tr>
        {% else %}
        <tr>
          <td colspan="6" class="text-center text-muted py-4">ไม่พบข้อมูลลูกค้า</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script>
  document.querySelectorAll('[data-bs-toggle="tooltip"]').forEach(el=>{
    new bootstrap.Tooltip(el);
  });
</script>
{% endblock %}
